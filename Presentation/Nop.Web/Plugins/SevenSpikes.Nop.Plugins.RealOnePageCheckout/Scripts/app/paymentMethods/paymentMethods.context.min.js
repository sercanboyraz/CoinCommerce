"use strict";function paymentMethodsContext(n,t,i,r,u,f){function c(i){return n.$broadcast("paymentMethodsContextChanging",{newPaymentMethodSelected:i,isMyRewardPointsChecked:e.useRewardPoints}),r.updatePaymentMethod(i).then(function(){n.$broadcast("paymentMethodsContextChanged",{newPaymentMethodSelected:i,isMyRewardPointsChecked:e.useRewardPoints})},function(i){return n.$broadcast("paymentMethodsContextChanged",{error:!0}),t.reject(i)})}function l(i){return n.$broadcast("paymentMethodsContextChanging",{useMyRewardPoints:i}),r.useMyRewardPoints(i).then(function(){n.$broadcast("paymentMethodsContextChanged",{useMyRewardPoints:i})},function(i){return n.$broadcast("paymentMethodsContextChanged",{error:!0}),t.reject(i)})}function a(n){if(e=n.paymentMethods,e.selectedPaymentMethod={},e.paymentMethods.length>0){var t=$.grep(e.paymentMethods,function(n){return n.selected});t.length>0&&(e.selectedPaymentMethod=t[0])}o.setState(e)}function s(i){return i||(i=$('select[name="billingCountry"]').val()),n.$broadcast("paymentMethodsContextChanging"),r.getPaymentMethods(i).then(function(t){if(e=t.data,e.selectedPaymentMethod={},e.paymentMethods.length>0){var i=$.grep(e.paymentMethods,function(n){return n.selected});i.length>0&&(e.selectedPaymentMethod=i[0])}o.setState(e);n.$broadcast("paymentMethodsContextChanged",{})},function(n){return e=o.getLastState(),t.reject(n)})}function v(){return e}function y(n){e&&(n.payment.paymentMethodSystemName!=e.selectedPaymentMethod.paymentMethodSystemName&&(angular.forEach(e.paymentMethods,function(t){t.paymentMethodSystemName==n.payment.paymentMethodSystemName&&(e.selectedPaymentMethod=t)}),c(n.payment)),n.useRewardPoints!=e.useRewardPoints&&(e.useRewardPoints=n.useRewardPoints,l(e.useRewardPoints)),o.setState(e))}var h={init:a,load:s,get:v,set:y},e,o=f.instance();return n.$on("resetPaymentMethodsData",function(n,t){e=undefined;t&&t.newCountryId?s(t.newCountryId):s()}),h}angular.module("realOnePageCheckout.paymentMethods").factory("paymentMethodsContext",paymentMethodsContext);paymentMethodsContext.$inject=["$rootScope","$q","api","paymentMethodsService","objectUtility","stateHolder"];