"use strict";function shippingMethodsContext(n,t,i,r,u,f){function l(n){e=undefined;n&&n.newCountryId?s(n.newCountryId):s()}function a(i){return n.$broadcast("shippingMethodsContextChanging",{newShippingMethodSelected:i}),r.updateShippingMethod(i).then(function(){n.$broadcast("shippingMethodsContextChanged",{newShippingMethodSelected:i,oldShippingMethodSelected:h})},function(i){return e=o.getLastState(),n.$broadcast("shippingMethodsContextChanged"),t.reject(i)})}function v(n){if(angular.isDefined(e)||(e={}),angular.isDefined(e.shippingMethods)||(e.shippingMethods=[]),e.shippingMethods=n.shippingMethods,e.warnings=n.warnings,e.notifyCustomerAboutShippingFromMultipleLocations=n.notifyCustomerAboutShippingFromMultipleLocations,e.selectedShippingMethod={},e.shippingMethods.length>0){var t=$.grep(e.shippingMethods,function(n){return n.selected});t.length>0&&(e.selectedShippingMethod=t[0])}o.setState(e)}function s(i){return i||(i=$('select[name="shippingCountry"]').val()),n.$broadcast("shippingMethodsContextChanging"),r.getShippingMethods(i).then(function(t){if(angular.isDefined(e)||(e={}),angular.isDefined(e.shippingMethods)||(e.shippingMethods=[]),e.shippingMethods=t.data.shippingMethods,e.warnings=t.data.warnings,e.notifyCustomerAboutShippingFromMultipleLocations=t.data.notifyCustomerAboutShippingFromMultipleLocations,e.selectedShippingMethod={},e.shippingMethods.length>0){var i=$.grep(e.shippingMethods,function(n){return n.selected});i.length>0&&(e.selectedShippingMethod=i[0])}o.setState(e);n.$broadcast("shippingMethodsContextChanged")},function(i){return e=o.getLastState(),n.$broadcast("shippingMethodsContextChanged"),t.reject(i)})}function y(){return e}function p(n){(n.name!=e.selectedShippingMethod.name||n.shippingRateComputationMethodSystemName!=e.selectedShippingMethod.shippingRateComputationMethodSystemName)&&(h=e.selectedShippingMethod,angular.forEach(e.shippingMethods,function(t){t.name==n.name&&t.shippingRateComputationMethodSystemName==n.shippingRateComputationMethodSystemName&&(e.selectedShippingMethod=t)}),a(n))}var c={init:v,load:s,get:y,set:p,resetShippingMethodsData:l},h,e,o=f.instance();return c}angular.module("realOnePageCheckout.shippingMethods").factory("shippingMethodsContext",shippingMethodsContext);shippingMethodsContext.$inject=["$rootScope","$q","api","shippingMethodsService","objectUtility","stateHolder"];