"use strict";function orderSummaryContext(n,o,t,d,m,u,e){var i,r={init:function(t){i=t.orderSummary;for(var e=0;e<i.items.length;e++){var r;0<i.items[e].allowedQuantities.length&&(r=i.items[e].quantity.toString(),i.items[e].quantity={text:r,value:r})}c.setState(i)},load:a,get:function(){return i},set:function(t){var e=$.grep(t,function(t){return t.deleted});0<e.length&&function(e){n.$broadcast("orderSummaryContextChanging",{removeCartItem:e}),d.removeCartItem(e).then(function(t){0===t.data.cartItemsCount?n.$broadcast("noCartItems"):(c.setState(i),n.$broadcast("orderSummaryContextChanged",{removeCartItem:e}),m.changeNumberOfItemsWhenEntireItemIsRemoved(e.quantity),u.broadcastNativeRemoveFromCartEvent(e.productId,e.quantity))},function(t){return i=c.getLastState(),n.$broadcast("orderSummaryContextChanged"),o.reject(t)})}(e[0]);var r=$.grep(t,function(t){return t.updated});{var a;0<r.length&&(a=$.grep(i.items,function(t){return t.id==r[0].id}))[0]&&r[0].quantity!=a[0].quantity&&function(a){n.$broadcast("orderSummaryContextChanging",{updateCartItem:a}),d.updateCartItem(a).then(function(t){var e,r=t.data;r&&0<r.length?0<(e=$.grep(i.items,function(t){return t.id==a.id})).length&&(e[0].warnings=r,n.$broadcast("orderSummaryContextChanged",{errorOccured:!0})):(m.changeNumberOfItemsWhenCartItemsQuantityIsUpdated(),n.$broadcast("orderSummaryContextChanged",{updateCartItem:a})),u.broadcastNativeAddOrRemoveFromCartEvent(a.productId,t.config.data.cartItemQuantity,c.getLastState(),a.id),c.setState(i)},function(t){return i=c.getLastState(),n.$broadcast("orderSummaryContextChanged"),o.reject(t)})}(r[0])}}},c=e.instance();function a(){return n.$broadcast("orderSummaryContextChanging"),m.showOverlay(".order-summary-content-loader"),d.getShoppingCartItems().then(function(t){i=t.data;for(var e,r=0;r<i.items.length;r++)0<i.items[r].allowedQuantities.length&&(e=i.items[r].quantity.toString(),i.items[r].quantity={text:e,value:e});c.setState(i),n.$broadcast("orderSummaryContextChanged"),m.hideOverlay(".order-summary-content-loader")},function(t){return i=c.getLastState(),n.$broadcast("orderSummaryContextChanged"),m.hideOverlay(".order-summary-content-loader"),o.reject(t)})}return n.$on("resetOrderSummaryData",function(){i=void 0,a()}),r}angular.module("realOnePageCheckout.orderSummary").factory("orderSummaryContext",orderSummaryContext),orderSummaryContext.$inject=["$rootScope","$q","api","orderSummaryService","objectUtility","nativeEventsUtility","stateHolder"];