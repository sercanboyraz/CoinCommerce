"use strict";function checkoutAttributesContext(n,t,i,r,u,f){function v(n,t){var r=$.grep(e,function(n){return n.id==t.id}),i;r.length>0&&(i=$.grep(r[0].values,function(i){return t.attributeControlType=="RadioList"&&(i.isPreSelected=!1),i.id==n.id}),i.length>0&&(i[0].isPreSelected=t.attributeControlType=="Checkboxes"?!i[0].isPreSelected:!0))}function y(n){var t=$.grep(e,function(t){return t.id===n.id});t.length>0&&(t[0].defaultValue=n.defaultValue)}function p(n){e=n.orderSummary.checkoutAttributes;o.setState(e)}function h(){return n.$broadcast("checkoutAttributesContextChanging"),r.getCheckoutAttributes().then(function(t){e=t.data;k();o.setState(e);n.$broadcast("checkoutAttributesContextChanged")},function(i){return e=o.getLastState(),n.$broadcast("checkoutAttributesContextChanged"),t.reject(i)})}function w(){return e}function b(i){var u=$.grep(i,function(n){return n.updated}),f,h,a,p;if(u.length>0){if(f={},u[0].attributeControlType=="TextBox"||u[0].attributeControlType=="MultilineTextbox"){if(h=$.grep(e,function(n){return n.id===u[0].id}),h.length>0&&h[0].defaultValue===u[0].defaultValue)return delete u[0].updated,!1}else if(u[0].attributeControlType=="Datepicker"){if(a=u[0].day&&u[0].month&&u[0].year||u[0].selectedDay>0&&u[0].selectedMonth>0&&u[0].selectedYear>0,p=typeof u[0].day!="undefined"||typeof u[0].month!="undefined"||typeof u[0].year!="undefined",p){if(!a&&$.inArray(u[0].id,s)==-1)return!1;s.push(u[0].id)}}else f.updateAttribute=!0;return n.$broadcast("checkoutAttributesContextChanging",f),r.updateCheckoutAttributes().then(function(t){var f={},s,i,r;switch(u[0].attributeControlType){case"TextBox":case"MultilineTextbox":y(u[0]);break;case"DropdownList":f.hasPriceAdjustment=l(u[0]);break;case"RadioList":case"Checkboxes":s=$.grep(u[0].values,function(n){return n.updated});s.length>0&&(f.hasPriceAdjustment=l(u[0]),v(s[0],u[0]))}for(i=0;i<e.length;i++)r=e[i],c(t.data.enabledattributeids,r,!0),c(t.data.disabledattributeids,r,!1),r.updated=undefined;o.setState(e);n.$broadcast("checkoutAttributesContextChanged",f)},function(i){return e=o.getLastState(),n.$broadcast("checkoutAttributesContextChanged"),t.reject(i)})}}function c(n,t,i){for(var u,r=0;r<n.length;r++)u=n[r],u==t.id&&(t.customProperties.enabled=i)}function l(n){var t=$.grep(n.values,function(n){return n.priceAdjustment!==null});return t.length>0?!0:!1}function k(){for(var t,n=0;n<e.length;n++)t=e[n],t.customProperties.enabled&&(t.updated=!0)}var a={init:p,load:h,get:w,set:b},e,o=f.instance(),s=[];return n.$on("resetCheckoutAttributesData",function(){e=undefined;h()}),a}angular.module("realOnePageCheckout.checkoutAttributes").factory("checkoutAttributesContext",checkoutAttributesContext);checkoutAttributesContext.$inject=["$rootScope","$q","api","checkoutAttributesService","objectUtility","stateHolder"];