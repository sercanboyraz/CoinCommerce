"use strict";function ShippingAddressController(e,a,i,n,p){var d=this;d.shippingData={},d.configData={};var r=!(d.configData.isVisible=!0),g=!1,o=!1;function l(){var e=d.configData.isVisible;d.requiredFields={firstName:e,lastName:e,email:e,company:e&&!1!==d.shippingData.settings.companyEnabled&&d.shippingData.settings.companyRequired,country:e&&!1!==d.shippingData.settings.countryEnabled,stateProvince:e&&d.shippingData.settings.stateProvinceEnabled,city:e&&!1!==d.shippingData.settings.cityEnabled&&d.shippingData.settings.cityRequired,county:e&&!1!==d.shippingData.settings.countyEnabled&&d.shippingData.settings.countyRequired,address1:e&&!1!==d.shippingData.settings.streetAddressEnabled&&d.shippingData.settings.streetAddressRequired,address2:e&&!1!==d.shippingData.settings.streetAddress2Enabled&&d.shippingData.settings.streetAddress2Required,zipPostalCode:e&&!1!==d.shippingData.settings.zipPostalCodeEnabled&&d.shippingData.settings.zipPostalCodeRequired,phoneNumber:e&&!1!==d.shippingData.settings.phoneEnabled&&d.shippingData.settings.phoneRequired,faxNumber:e&&!1!==d.shippingData.settings.faxEnabled&&d.shippingData.settings.faxRequired}}function t(){d.shippingData.selectedShippingAddress={country:{},stateProvince:{}},n.set(d.shippingData.selectedShippingAddress)}d.addressAttributeChanged=function(e,i){p.syncAttributeWithModel(i,e)},e.$on("checkoutDataLoaded",function(e,i){n.init(i);var s=n.get();if(angular.copy(s,d.shippingData),angular.isDefined(i.configuration.shipToSameAddress)&&(r=i.configuration.shipToSameAddress),angular.isDefined(i.configuration.hasProductsRequiringShipping)&&(o=i.configuration.hasProductsRequiringShipping),angular.isDefined(i.configuration.pickUpInStoreModel)){var t=JSON.parse(i.configuration.pickUpInStoreModel);g=t.pickUpInStore}d.configData.isVisible=!r&&!g&&o,!angular.isDefined(d.requiredFields)&&angular.isDefined(d.shippingData.settings)&&l(),d.shippingData.selectedShippingAddress&&d.shippingData.selectedShippingAddress.customAddressAttributes&&0<d.shippingData.selectedShippingAddress.customAddressAttributes.length&&!angular.isDefined(d.modelsData)&&(d.modelsData={},p.prepareDefaultSelectedValues(d.shippingData.selectedShippingAddress,d.modelsData)),function(){var s=!0;a.$watch("vm.shippingData.selectedShippingAddress",function(e,i){e&&i&&!s?n.set(e):s=!1},!0)}()}),e.$on("togglePanel",function(e,i){angular.isDefined(i.shipToSameAddress)&&(r=i.shipToSameAddress),angular.isDefined(i.pickUpInStore)&&!0===(g=i.pickUpInStore)&&t(),angular.isDefined(i.hasProductsRequiringShipping)&&(!1!==(o=i.hasProductsRequiringShipping)||g||t()),d.configData.isVisible=!(r||g)&&o,angular.isDefined(d.shippingData.settings)&&l();var s=n.get();angular.copy(s,d.shippingData)}),e.$on("updateShippingAddress",function(e,i){i&&i.address&&(angular.copy(i.address,d.shippingData.selectedShippingAddress),p.prepareDefaultSelectedValues(d.shippingData.selectedShippingAddress,d.modelsData))}),e.$on("refresh",function(e,i){if(null!=i.controller&&"ShippingAddressController"!=i.controller)return!1;var s=n.get();angular.copy(s,d.shippingData),!angular.isDefined(d.requiredFields)&&angular.isDefined(d.shippingData.settings)&&l(),d.shippingData.selectedShippingAddress&&d.shippingData.selectedShippingAddress.customAddressAttributes&&0<d.shippingData.selectedShippingAddress.customAddressAttributes.length&&!angular.isDefined(d.modelsData)&&(d.modelsData={},p.prepareDefaultSelectedValues(d.shippingData.selectedShippingAddress,d.modelsData)),p.hideOverlay(".shipping-address-loader")}),e.$on("setShippingAddressOverlay",function(){p.showOverlay(".shipping-address-loader")}),e.$on("prepareDefaultSelectedValuesForCustomAddressAttributes",function(e,i){("shipping"==i.panel||"billing"==i.panel&&i.shipToSameAddress)&&setTimeout(function(){a.$apply(function(){p.prepareDefaultSelectedValues(d.shippingData.selectedShippingAddress,d.modelsData)})})}),$(".shipping-address .choose-address select").change(function(){e.$broadcast("addressChanged",{panel:"shipping",shipToSameAddress:d.shipToSameAddress})})}angular.module("realOnePageCheckout.shippingAddress").controller("ShippingAddressController",ShippingAddressController),ShippingAddressController.$inject=["$rootScope","$scope","$timeout","shippingAddressContext","objectUtility"];